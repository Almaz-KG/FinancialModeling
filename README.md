Этюды для программистов
Финансовые воротилы, или Управление предприятиями и машинное моделирование

Решением совета директором крупного промышленного концерна вы назначены
президентом компани. Компания владеет несколькими фабриками. Каждый
месяц компания покупает сырье, обрабатывает его и продает изготовленную
продукцию публике, ждущей ее с нетерпением. Вам теперь придется
решать, сколько и каких товаров выпускать, стоит ли и когда именно
расширять производственные мощности, как финансировать их расширение
и как принять скромно-застенчивый вид, отчитываясь о незаконных прибылях.
Перед тем как приступить к работе, вы строите модель промышленности в целом,
чтобы в частном порядке отработать свою линию поведения. И вот какую игру
вы в результате изобрели.

НАЧАЛЬНАЯ СИТУАЦИЯ

Моделирование ведется с шагом по времени в один месяц. В начале игры
каждый игрок (президент компании) получает 2 обычные фабрики, 4 единицы сырья
и материалов (сокращенно ЕСМ), две единицы готовой продукции (сокращенно ЕГП)
и 10,000$ наличными. Игроки занумерованы от 1 до N, и в первом круге игрок
1 - старший. С каждым кругом (т.е. ежемесячно) роль старшего переходит к
следующему по порядку номеров игроку, после N-го старшим становится опять первый
(номер старшего в круге T вычисляется по формуле (T mod N) + 1. На торгах
при прочих равных условиях выигрывает самый старший игрок (тот, кто будет
старшим в следующем круге).

ЕЖЕМЕСЯЧНЫЕ ОПЕРАЦИИ
Описание ниже сделки происходят каждый месяц и именно в таком порядке. Если в
какой-то момент компания не может выполнить своих финансовых обязательств,
она немедленно объявляется банкротом. Ее имущество пропадает, и она выходит
из игры (так что лучше иметь наготове запас наличных). Все денежные расчеты
происходят между отдельными игроками и одним общим банком. Невозможна передача
денег прямо от игрока к игроку, что исключает сговор, направленный против
какой-либо компании. Банк, кроме того, контролирует источники сырья и скупает
всю готовую продукцию.

1. Постоянные издержки.
Каждый игрок (в порядке убывания старшинства, начиная со старшего) платит 300$
за каждую имеющуюся у него ЕСМ, 500$ за каждую наличную ЕГП, 1000$ за владение
каждой обычной фабрикой и 1500$ - за владение автоматизированной. Это
постоянные издержки каждого игрока, даже если он в этом круге не предпринимает
никаких других действий.

2. Определение обстановки на рынке. Банк решает и сообщает игрокам,
сколько ЕСМ продаст в этот раз и какова их минимальная цена. Объявляется
также, сколько ЕГП в общей сложности будет закуплено и какова максимальная
цена.

Таблица 1. Уровни цен на ЕСМ и ЕГП
______________________________________________________
Уровень     ЕСМ     Мин. цена       ЕГП     Макс. цена
______________________________________________________
1           1.0P    $800            3.0P    $6500
2           1.5P    $650            2.5P    $6000
3           2.0P    $500            2.0P    $5500
4           2.5P    $400            1.5P    $5000
5           3.0P    $300            1.0P    $4500
______________________________________________________

В таблице 1 приведены пять уровней предложения ЕСМ и спроса ЕГП (обратите
внимание, что с ростом одной из этих величин другая убывает), а так же верхние
и нижние границы цен для каждого случая. В число игроков P не включены те,
кто обанкротился, и P может, таким образом, быть меньше N. Произведения
1.5Р и 2.5Р округляются до ближайщего целого с недостатком. В таблице 2.
приведена матрица вероятностей перехода, в соответствии с которой банк определяет
новый месячный уровень спроса и предложения, исходя их прежнего. Предполагается,
что в нулевом месяце уровень равен 3.

Таблица 2. Вероятности перехода уровней цен в друг в друга
________________________________________________
Старый                  Новый уровень
уровень     1       2       3       4       5
________________________________________________
1           1/3     1/3     1/6     1/12    1/12
2           1/4     1/3     1/4     1/12    1/12
3           1/12    1/4     1/3     1/4     1/12
4           1/12    1/12    1/4     1/3     1/4
5           1/12    1/12    1/6     1/3     1/3
________________________________________________


3. Заявки на сырье и материалы. Каждый игрок тайно от других готовит заявку
на ЕСМ на текущий месяц. В заявке указывается требуемое число ЕСМ и предлагается
цена не ниже банковской минимальной (запрос нуля ЕСМ или предложение цены
ниже минимальной автоматически исключает игрока из торгов в этом месяце).
Все заявки раскрываются одновременно, и имеющиеся ЕСМ распределяются
между игроками в порядке убывания предложенной цены. Если сырья не хватает
на всех, заявки с предложением более низкой цены не удовлетворяются. При прочих
равных условиях сырье достается самому старшему игроку. Игроки платят за сырье
при его получении. Банк не сохраняет оставшееся после удовлетворения заявок
сырье на следующий месяц.

4. Производство продукции. Все игроки по очереди (по убыванию старшинства,
начиная со старшего) объявляют, сколько ЕСМ они собираются переработать в ЕГП
в текущем месяце и на каких фабриках. Каждый игрок обязан тут же покрыть
расходы на производство. Обычная фабрика может за месяц переработать одну ЕСМ
при затратах в 2000$. Автоматизированная фабрика может либо сделать то же,
либо переработать 2 ЕСМ при затратах в 3000$. Конечно, чтобы переработать ЕСМ,
их надо иметь.

5. Продажа продукции.
При покупке банком у игроков ЕГП организуются примерно такие же торги, как
и при продаже ЕСМ. Заявленные цены не должны превышать максимальную цену,
установленную банком, причем банк покупает ЕГП в первую очередь у тех, кто
заявил более низкую цену. При прочих равных условиях предпочтение отдается
старшему игроку. Если предложение превышает спрос, наиболее дорогие ЕГП
остаются не проданными. Игроки получают деньги за продукцию при ее продаже.

6. Выплата ссудного процента. Каждый игрок платит 1% от общей суммы непогащенных
ссуд, в том числе и тех, которые будут погащены в текущем месяце.

7. Погашение ссуд. Каждый игрок, получивщий ссуду сроком до текущего месяца,
должен ее погасить. Поскольку возвращение ссуд предшествует получению новых,
платить надо наличными.

8. Получение ссуд. Теперь каждый игрок может получить ссуду. Ссуды
обеспечиваются имеющимися у игрока фабриками; под обычную фабрику дается
ссуда в 5,000$, под автоматизированную - 10,000$. Общая сумма непогащенных
ссуд не может превышать половины гарантированного капитала, но в этих
пределах можно свободно занимать. Банк немедленно выплачивает ссуду игроку.
Срок погашения ссуды истекает через 12 месяцев - например, ссуду, взятую в
3-м месяце, возвращать надо в 15-м. Нельзя погашать ссуды раньше срока.

9. Заявки на строительство. Игроки могут строить новые фабрики. Обычная
фабрика стоит 5000$ и начинает давать продукцию на 5-ый месяц после начала
строительства; автоматизированная фабрика стоит 10,000$ и дает продукцию
на 7-й месяц после начала строительства. Обычную фабрику можно автоматизировать
за 7000$, реконструкция продолжается 9 месяцев, все это время фабрика
может работать как обычная. Половину стоимости фабрики надо платить в начале
строительства, вторую половину - за месяц до начала выпуска подукции в этой
же фазе цикла. Общее число имеющихся и строящихся фабрик у каждого игрока не
должно превышать шести.

Окончание игры и подсчет результатов
Игра оканчивается после некоторого фиксированныго числа кругов (13 и более) или
когда обанкротятся все игроки, кроме одного. Чтобы подсчитать общий капитал
компании, надо сложить стоимости всех фабрик (по цене, по которой их можно
было бы построить заново), стоимость имеющихся у нее ЕСМ (по минимальной
банковской цене текущего месяца), стоимость имеющихся ЕГП (по максимальной
банковской цене текущего месяца) и имеющиеся у компании наличные. После этого
надо вычесть общую сумму ссуд и предстоящих расходов по уже начатому строительству.
Если к концу игры приходит несколько игроков, результаты считаются по их капиталам.

Любой игрок в любой момент может узнать состояние дел любого другого игрока -
его капитал, наличные, взятые ссуды, все что касается готовой продукции,
имеющихся и строящихся фабрик. Во время торгов игроки ничего не знают о заявках,
сделанных другими, но, как только банк собрал все заявки, они обнародуются и
количество купленных или проданных каждым игроком единиц становится известно всем.
Игроки могут сами вести любые записи, но банк не предоставляет им никакой
информации, кроме той, которая предусмотрена правилами игры.

Задача состоит из двух частей. Первая заключается в том, чтобы написать программу,
которая управляет ходом моделирования - программу-банкир. Эта программа должна
полностью контролировать игру: устанавливать цены, закупать продукцию и продавать
сырье, проводить торги, вести учет и т.д. Эта программа должна в соответствуюшие
моменты опрашивать игроков и добиваться соблюдения ими всех правил. В частности,
банкир защищает от несанкционированного доступа всю информацию, как свою, так
и чужую, касающуюся учета и состояния дел отдельных игроков. Программа-банкир
периодически (например, ежемесячно) выдает сводный финансовый отчет. Поскольку
отчеты эти предстоит читать людям, они должны быть понятны и приемлемы с
эстетической точки зрения.

Вторая часть задачи - написать программы поведения игроков. Каждая программа-игрок
должна быть в состоянии отвечать на любые запросы программы-банкира по ходу игры:
она должна уметь предлагать цену на сырье, принимать решения, продавать готовую
продукцию и т.п. Если для моделирования используется
диалоговая система, реализуйте одну из программ-игроков таким образом, чтобы она
просто передавала свои запросы игроку-человеку, находящемуся за компьютером.
Такая программа должна уметь отвечать на запросы человека о состоянии игры.

После того как будет написано несколько программ-игроков, их надо объеденить с
программной-банкиром, чтобы получилась полная игровая система. Проведите с этой
системой несколько игр и изучите результаты. Заметим, что несколько экземпляров
одной и той же программы-игрока вполне могут выступать в качестве
противников (т.е. мы считаем людей в соответствуюшей реальной игре изначально
одинаковыми). Но для полной гарантии надо написать хотя бы две нетривиальные
программы-игрока.

Указания исполнителю. Эта игра - пример последовательного, или пошагового,
моделирования, при котором все события (кроме банкротств) просиходят в строго
определенном, заранее известном порядке. Цикл по месяцам - удобная структура
для ведущей программы. Редко можно встретить задачу на программирование
прикладную или науную, столь удобную для хорошо структурированной реализации,
как эта. Не премините воспользоваться такой возможностью.

Длительность исполнения.
Одному исполнителю на 4 недели, двум - на 3, трем - на 2. Две недели
должно уйти на программу-игрока.

Развитие темы.
Дополнительное удовольствие от программирования игр - возможность поиграть с
программой-игроком. Иногда при применени совсем простых эвристических методов
может получиться удивительно сложное поведение. В программу, реализующую
стратегию игрока, несложно включить элементы самообучения, чтобы ее поведение
со временем совершенствовалось. Проведите несколько тренировочных турниров
с участием как людей, так и программ (люди тоже обучаемы). Имеется стандартный
прием обучения интеллектуальных программ новым стратегиям. Один экземпляр (Альфа)
обучается в тренировочной серии игр, второй (Бета) остается на том же уровне
знаний, какой он имел перед этой серией. Затем устраивается сравнительная серия
игр между ними; если Альфа побеждает, его знания передаются всем копиям
программ-игроков, в противном случае Альфа эти знания забывает как бесполезные
и с ним проводится новая тренировочная серия.

Игру можно сделать интереснее, если добавить новые правила, которые, видимо,
приблизят ее к реальной жизни. Ниже перечислены дополнительные правила.
Если какое-либо из правил включается, все правила с меньшими номерами
также надо включать.
1. Чрезвычайные ссуды. В случае финансовых затруднений каждый игрок может
взять чрезвычайную ссуду. Такая ссуда стоит 2% в месяц вместо обычного 1%
предоставляется сроком на 4 месяца (ссудный процент выплачивается в обычном
порядке). Общая сумма непогащенных задолжностей по-прежнему не может быть
больше половины суммы, обеспечиваемой всеми фабриками данного игрока. Нельзя
брать чрезвычайные ссуды для спасения от банкротства в момент, когда банк
уже требует платежа по какому-либо обязательству. Брать чрезвычайную
ссуду можно не позже начала цикла, в котором подходит срок платежа.
2. Чрезвычайные поисшествия. В начале каждого цикла, непосредственно перед
выплатой постоянных издержек, банк объявляет обо всех чрезвычайных происшествиях
на этот месяц. В таблице 3 приведены вероятности различных чрезвычайных
происшествий. Эффект приведенных ниже изменений в расценках накапливается на
каждом шаге: так, 10%-ный рост с последующим 10%-ным спадом дает в результате
99% исходного уровня. К чрезвычайным происшествиям относятся:
Забастовка - игрок, у которого началась забастовка, может прекратить производство
на 3 месяца, начиная с текущего, или вплоть до конца игры увеличить на 10%
все издержки (как постоянные, так и производственные). Игрок, прекративщий
производство, может участвовать во всех прочих действиям и должен по-прежнему
нести постоянные издержки.
Транспортный кризис - те, кого он затронул, не могу в этом месяце ни покупать
сырье, ни продавать продукцию.
Чрезвычайный налог - те, кого это касается, должны немедленно сделать
однократные взнос, исходя из расчета 500$ за фабрику. Запрещается для выплаты
этой суммы прибегать к чрезвычайным ссудам. Возможно банкротство.
Авария - у игрока, которого это касается, одна из фабрик (по возможности
обычная) в этом месяце не выпускает продукции.
Внедрение новой техники - у игроков, которых это касается, впроть до конца игры
на 10% снижаются издержки производства.
Неожиданная удача - соответствующий игрок может немедленно продать любое
число из имеющихся у него ЕГП по 6500$.

Таблица 3. Вероятности чрезвычайных происшествий. Испытываются на каждом игроке
в каждом цикле:
1% - у игрока забастовка
1% - игрок пострадал от транспортного кризиса
1% - на одной из фабрик игрока авария
2% - с игрока причитается чрезвычайный налог
2% - игрок пожинает плоды внедрения новой техники
2% - у игрока неожиданная удача
91% - у игрока на этот раз ничего чрезвычайного не поизошло.

3. Закрытие фабрики. В очередной месяц, как раз перед подачей заявки на строительство,
игрок может закрыть все или некоторые свои фабрики. Начиная со следующего
месяца постоянные издержки по такой фабрике сократятся вдвое, но продукции не будет
совсем. Впоследстви закрытую фабрику можно открыть в той же точке очередного месячного
цикла. Через два месяца после этого фабрика снова вступает в строй, и надо опять
оплачивать издержки в полном размере. Например, вновь открытая в 13-м месяце
фабрика вступает в строй действующих в 15-м.

4. Дробление заявок. На любых торгах любой игрок может сделать одну заявку, две
или ни одной. Общий объем заявок одного игрока как на покупку, так и на продажу
не должен превосходить предложений банка (для продажи - еще и имеющегося у данного
игрока объема продукции). Банк расмаривает различные заявки одного игрока точно
так же, как заявки разных игроков. Заявки эти конкурируют как друг с другом, так
и с заявками других игроков. Удовлетворены могут быь обе, одна или ни одной. При
прочих равных условиях по-прежнему побеждает старший игрок.
